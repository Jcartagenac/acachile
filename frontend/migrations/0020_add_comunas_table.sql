-- Migration 0020: Add shop_comunas table and customer_comuna field
-- Date: 2024-12-01
-- Purpose: Support comuna selection filtered by region in checkout

-- Add customer_comuna field to shop_orders
ALTER TABLE shop_orders ADD COLUMN customer_comuna TEXT;

-- Create comunas table
CREATE TABLE IF NOT EXISTS shop_comunas (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  region_code TEXT NOT NULL,
  comuna_name TEXT NOT NULL,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (region_code) REFERENCES shop_shipping_rates(region_code)
);

-- Create index for faster lookups
CREATE INDEX IF NOT EXISTS idx_comunas_region ON shop_comunas(region_code);
CREATE INDEX IF NOT EXISTS idx_orders_comuna ON shop_orders(customer_comuna);

-- Insert comunas for each region
-- Región XV - Arica y Parinacota
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('XV', 'Arica'),
('XV', 'Camarones'),
('XV', 'General Lagos'),
('XV', 'Putre');

-- Región I - Tarapacá
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('I', 'Alto Hospicio'),
('I', 'Camiña'),
('I', 'Colchane'),
('I', 'Huara'),
('I', 'Iquique'),
('I', 'Pica'),
('I', 'Pozo Almonte');

-- Región II - Antofagasta
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('II', 'Antofagasta'),
('II', 'Calama'),
('II', 'María Elena'),
('II', 'Mejillones'),
('II', 'Ollagüe'),
('II', 'San Pedro de Atacama'),
('II', 'Sierra Gorda'),
('II', 'Taltal'),
('II', 'Tocopilla');

-- Región III - Atacama
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('III', 'Alto del Carmen'),
('III', 'Caldera'),
('III', 'Chañaral'),
('III', 'Copiapó'),
('III', 'Diego de Almagro'),
('III', 'Freirina'),
('III', 'Huasco'),
('III', 'Tierra Amarilla'),
('III', 'Vallenar');

-- Región IV - Coquimbo
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('IV', 'Andacollo'),
('IV', 'Canela'),
('IV', 'Combarbalá'),
('IV', 'Coquimbo'),
('IV', 'Illapel'),
('IV', 'La Higuera'),
('IV', 'La Serena'),
('IV', 'Los Vilos'),
('IV', 'Monte Patria'),
('IV', 'Ovalle'),
('IV', 'Paihuano'),
('IV', 'Punitaqui'),
('IV', 'Río Hurtado'),
('IV', 'Salamanca'),
('IV', 'Vicuña');

-- Región V - Valparaíso
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('V', 'Algarrobo'),
('V', 'Cabildo'),
('V', 'Calera'),
('V', 'Calle Larga'),
('V', 'Cartagena'),
('V', 'Casablanca'),
('V', 'Catemu'),
('V', 'Concón'),
('V', 'El Quisco'),
('V', 'El Tabo'),
('V', 'Hijuelas'),
('V', 'Isla de Pascua'),
('V', 'Juan Fernández'),
('V', 'La Cruz'),
('V', 'La Ligua'),
('V', 'Limache'),
('V', 'Llaillay'),
('V', 'Los Andes'),
('V', 'Nogales'),
('V', 'Olmué'),
('V', 'Panquehue'),
('V', 'Papudo'),
('V', 'Petorca'),
('V', 'Puchuncaví'),
('V', 'Putaendo'),
('V', 'Quillota'),
('V', 'Quilpué'),
('V', 'Quintero'),
('V', 'Rinconada'),
('V', 'San Antonio'),
('V', 'San Esteban'),
('V', 'San Felipe'),
('V', 'Santa María'),
('V', 'Santo Domingo'),
('V', 'Valparaíso'),
('V', 'Villa Alemana'),
('V', 'Viña del Mar'),
('V', 'Zapallar');

-- Región RM - Metropolitana
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('RM', 'Alhué'),
('RM', 'Buin'),
('RM', 'Calera de Tango'),
('RM', 'Cerrillos'),
('RM', 'Cerro Navia'),
('RM', 'Colina'),
('RM', 'Conchalí'),
('RM', 'Curacaví'),
('RM', 'El Bosque'),
('RM', 'El Monte'),
('RM', 'Estación Central'),
('RM', 'Huechuraba'),
('RM', 'Independencia'),
('RM', 'Isla de Maipo'),
('RM', 'La Cisterna'),
('RM', 'La Florida'),
('RM', 'La Granja'),
('RM', 'La Pintana'),
('RM', 'La Reina'),
('RM', 'Lampa'),
('RM', 'Las Condes'),
('RM', 'Lo Barnechea'),
('RM', 'Lo Espejo'),
('RM', 'Lo Prado'),
('RM', 'Macul'),
('RM', 'Maipú'),
('RM', 'María Pinto'),
('RM', 'Melipilla'),
('RM', 'Ñuñoa'),
('RM', 'Padre Hurtado'),
('RM', 'Paine'),
('RM', 'Pedro Aguirre Cerda'),
('RM', 'Peñaflor'),
('RM', 'Peñalolén'),
('RM', 'Pirque'),
('RM', 'Providencia'),
('RM', 'Pudahuel'),
('RM', 'Puente Alto'),
('RM', 'Quilicura'),
('RM', 'Quinta Normal'),
('RM', 'Recoleta'),
('RM', 'Renca'),
('RM', 'San Bernardo'),
('RM', 'San Joaquín'),
('RM', 'San José de Maipo'),
('RM', 'San Miguel'),
('RM', 'San Pedro'),
('RM', 'San Ramón'),
('RM', 'Santiago'),
('RM', 'Talagante'),
('RM', 'Tiltil'),
('RM', 'Vitacura');

-- Región VI - O'Higgins
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('VI', 'Chépica'),
('VI', 'Chimbarongo'),
('VI', 'Codegua'),
('VI', 'Coinco'),
('VI', 'Coltauco'),
('VI', 'Doñihue'),
('VI', 'Graneros'),
('VI', 'La Estrella'),
('VI', 'Las Cabras'),
('VI', 'Litueche'),
('VI', 'Lolol'),
('VI', 'Machalí'),
('VI', 'Malloa'),
('VI', 'Marchihue'),
('VI', 'Nancagua'),
('VI', 'Navidad'),
('VI', 'Olivar'),
('VI', 'Palmilla'),
('VI', 'Paredones'),
('VI', 'Peralillo'),
('VI', 'Peumo'),
('VI', 'Pichidegua'),
('VI', 'Pichilemu'),
('VI', 'Placilla'),
('VI', 'Pumanque'),
('VI', 'Quinta de Tilcoco'),
('VI', 'Rancagua'),
('VI', 'Rengo'),
('VI', 'Requínoa'),
('VI', 'San Fernando'),
('VI', 'San Vicente'),
('VI', 'Santa Cruz');

-- Región VII - Maule
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('VII', 'Cauquenes'),
('VII', 'Chanco'),
('VII', 'Colbún'),
('VII', 'Constitución'),
('VII', 'Curepto'),
('VII', 'Curicó'),
('VII', 'Empedrado'),
('VII', 'Hualañé'),
('VII', 'Licantén'),
('VII', 'Linares'),
('VII', 'Longaví'),
('VII', 'Maule'),
('VII', 'Molina'),
('VII', 'Parral'),
('VII', 'Pelarco'),
('VII', 'Pelluhue'),
('VII', 'Pencahue'),
('VII', 'Rauco'),
('VII', 'Retiro'),
('VII', 'Río Claro'),
('VII', 'Romeral'),
('VII', 'Sagrada Familia'),
('VII', 'San Clemente'),
('VII', 'San Javier'),
('VII', 'San Rafael'),
('VII', 'Talca'),
('VII', 'Teno'),
('VII', 'Vichuquén'),
('VII', 'Villa Alegre'),
('VII', 'Yerbas Buenas');

-- Región XVI - Ñuble
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('XVI', 'Bulnes'),
('XVI', 'Chillán'),
('XVI', 'Chillán Viejo'),
('XVI', 'Cobquecura'),
('XVI', 'Coelemu'),
('XVI', 'Coihueco'),
('XVI', 'El Carmen'),
('XVI', 'Ninhue'),
('XVI', 'Ñiquén'),
('XVI', 'Pemuco'),
('XVI', 'Pinto'),
('XVI', 'Portezuelo'),
('XVI', 'Quillón'),
('XVI', 'Quirihue'),
('XVI', 'Ránquil'),
('XVI', 'San Carlos'),
('XVI', 'San Fabián'),
('XVI', 'San Ignacio'),
('XVI', 'San Nicolás'),
('XVI', 'Treguaco'),
('XVI', 'Yungay');

-- Región VIII - Biobío
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('VIII', 'Alto Biobío'),
('VIII', 'Antuco'),
('VIII', 'Arauco'),
('VIII', 'Cabrero'),
('VIII', 'Cañete'),
('VIII', 'Chiguayante'),
('VIII', 'Concepción'),
('VIII', 'Contulmo'),
('VIII', 'Coronel'),
('VIII', 'Curanilahue'),
('VIII', 'Florida'),
('VIII', 'Hualpén'),
('VIII', 'Hualqui'),
('VIII', 'Laja'),
('VIII', 'Lebu'),
('VIII', 'Los Álamos'),
('VIII', 'Los Ángeles'),
('VIII', 'Lota'),
('VIII', 'Mulchén'),
('VIII', 'Nacimiento'),
('VIII', 'Negrete'),
('VIII', 'Penco'),
('VIII', 'Quilaco'),
('VIII', 'Quilleco'),
('VIII', 'San Pedro de la Paz'),
('VIII', 'San Rosendo'),
('VIII', 'Santa Bárbara'),
('VIII', 'Santa Juana'),
('VIII', 'Talcahuano'),
('VIII', 'Tirúa'),
('VIII', 'Tomé'),
('VIII', 'Tucapel'),
('VIII', 'Yumbel');

-- Región IX - La Araucanía
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('IX', 'Angol'),
('IX', 'Carahue'),
('IX', 'Cholchol'),
('IX', 'Collipulli'),
('IX', 'Cunco'),
('IX', 'Curacautín'),
('IX', 'Curarrehue'),
('IX', 'Ercilla'),
('IX', 'Freire'),
('IX', 'Galvarino'),
('IX', 'Gorbea'),
('IX', 'Lautaro'),
('IX', 'Loncoche'),
('IX', 'Lonquimay'),
('IX', 'Los Sauces'),
('IX', 'Lumaco'),
('IX', 'Melipeuco'),
('IX', 'Nueva Imperial'),
('IX', 'Padre Las Casas'),
('IX', 'Perquenco'),
('IX', 'Pitrufquén'),
('IX', 'Pucón'),
('IX', 'Purén'),
('IX', 'Renaico'),
('IX', 'Saavedra'),
('IX', 'Temuco'),
('IX', 'Teodoro Schmidt'),
('IX', 'Toltén'),
('IX', 'Traiguén'),
('IX', 'Victoria'),
('IX', 'Vilcún'),
('IX', 'Villarrica');

-- Región XIV - Los Ríos
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('XIV', 'Corral'),
('XIV', 'Futrono'),
('XIV', 'La Unión'),
('XIV', 'Lago Ranco'),
('XIV', 'Lanco'),
('XIV', 'Los Lagos'),
('XIV', 'Máfil'),
('XIV', 'Mariquina'),
('XIV', 'Paillaco'),
('XIV', 'Panguipulli'),
('XIV', 'Río Bueno'),
('XIV', 'Valdivia');

-- Región X - Los Lagos
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('X', 'Ancud'),
('X', 'Calbuco'),
('X', 'Castro'),
('X', 'Chaitén'),
('X', 'Chonchi'),
('X', 'Cochamó'),
('X', 'Curaco de Vélez'),
('X', 'Dalcahue'),
('X', 'Fresia'),
('X', 'Frutillar'),
('X', 'Futaleufú'),
('X', 'Hualaihué'),
('X', 'Llanquihue'),
('X', 'Los Muermos'),
('X', 'Maullín'),
('X', 'Osorno'),
('X', 'Palena'),
('X', 'Puerto Montt'),
('X', 'Puerto Octay'),
('X', 'Puerto Varas'),
('X', 'Puqueldón'),
('X', 'Purranque'),
('X', 'Puyehue'),
('X', 'Queilén'),
('X', 'Quellón'),
('X', 'Quemchi'),
('X', 'Quinchao'),
('X', 'Río Negro'),
('X', 'San Juan de la Costa'),
('X', 'San Pablo');

-- Región XI - Aysén
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('XI', 'Aysén'),
('XI', 'Chile Chico'),
('XI', 'Cisnes'),
('XI', 'Cochrane'),
('XI', 'Coyhaique'),
('XI', 'Guaitecas'),
('XI', 'Lago Verde'),
('XI', 'O''Higgins'),
('XI', 'Río Ibáñez'),
('XI', 'Tortel');

-- Región XII - Magallanes
INSERT INTO shop_comunas (region_code, comuna_name) VALUES
('XII', 'Antártica'),
('XII', 'Cabo de Hornos'),
('XII', 'Laguna Blanca'),
('XII', 'Natales'),
('XII', 'Porvenir'),
('XII', 'Primavera'),
('XII', 'Punta Arenas'),
('XII', 'Río Verde'),
('XII', 'San Gregorio'),
('XII', 'Timaukel'),
('XII', 'Torres del Paine');
